var base_pricemod=1.2,base_buyback=.6;angular.module("underscore",[]).factory("_",function(){return window._}),angular.module("dig",["ngAnimate","underscore"]).factory("animate",["$window","$rootScope",function(n,e){Date.now||(Date.now=function(){return(new Date).getTime()}),function(){for(var n=["webkit","moz"],e=0;e<n.length&&!window.requestAnimationFrame;++e){var t=n[e];window.requestAnimationFrame=window[t+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t+"CancelAnimationFrame"]||window[t+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var i=0;window.requestAnimationFrame=function(n){var e=Date.now(),t=Math.max(i+16,e);return setTimeout(function(){n(i=t)},t-e)},window.cancelAnimationFrame=clearTimeout}}();var t=n.requestAnimationFrame;return function(n){t(function(t){e.$apply(function(){n(t)})})}}]).directive("display",["$window","$document","animate",function(n,e,t){return{scope:!0,restrict:"A",template:['<div class="wrapper"></div>','<div class="horizon" style="background-position: 0px -{{bgPos(depth)}}px;">','<div class="inner" data-depth="{{depth | number:0}}" style="height: {{holeHeight(depth) || \'100%\'}}; width: {{holeWidth()}}px; background-position: 0px -{{bgPos(depth)}}px;">','<div data-ng-repeat="item in displayArray | orderBy:\'$index\':true" class="miniondiv" style="width: {{holeWidth()}}px;">','<span data-ng-repeat="count in ngArray(item.owned) track by $index">','<img data-ng-src="dist/img/{{item.name}}.png" />',"</span>","</div>","</div>","</div>"].join("\n"),link:function(i){var o=angular.element(n).height();i.holeHeight=function(n){return o>.2*n?.2*n+"px":void 0},i.bgPos=function(n){return o>.2*n?0:.2*(n-o)},i.holeWidth=function(){return Math.min(700,Math.max(350,_(i.shop).reduce(function(n,e){return n+e.owned*e.digValue},0)))},i.displayArray=[],i.$watch("shop",function(){i.displayArray=_.values(i.shop).reverse(),console.log(i.displayArray)}),function a(){angular.element(n).scrollTop(e.height()),t(a)}()}}}]).service("configuration",["$http",function(n){return{load:function(e,t){return n.get(t?e:e)}}}]).controller("game",["$scope","$timeout","$document","configuration","animate",function(n,e,t,i,o){n.depth=0,n.funds=0,n.digValue=1,n.shop={},n.upgrades={},n.achievements=[],i.load("configuration.json",!0).success(function(e){n.shop=e.shop,n.upgrades=e.upgrades,n.achievements=e.achievements}).error(function(){console.log("ERROR")}),n.currentCost=function(e){return Math.round(n.shop[e].cost*Math.pow(base_pricemod,n.shop[e].owned))},n.dig=function(e){var t=e||n.digValue;n.funds+=t,n.depth+=t/5},n.purchaseShopItem=function(e){e&&n.funds>=n.currentCost(e)&&(n.funds-=n.currentCost(e),n.shop[e].owned+=1)},n.sellShopItem=function(e){e&&n.owned>0&&(n.funds+=Math.round(n.currentCost(e)*base_buyback),n.shop[e].owned-=1)},n.purchaseUpgradeItem=function(e){e&&n.funds>=n.upgrades[e].cost&&(n.$eval(n.upgrades[e].effect),n.funds-=n.upgrades[e].cost,n.upgrades[e].enabled=!0)},n.showUpgradeItem=function(e){return n.$eval(e)},n.ngArray=function(n){return new Array(n)};var a=0,r=Date.now();o(function u(e){var t=e-r;r=e;var i=_(n.shop).filter(function(n){return n.owned}).reduce(function(n,e){return n+e.owned*e.digValue*t*e.cycle},0);i&&n.dig(i/1e3),_(n.upgrades).filter(function(n){return!n.available}).each(function(e){e.available=n.$eval(e.unlocks)?!0:!1}),_(n.achievements).filter(function(n){return!n.nailed}).each(function(e){e.nailed=n.$eval(e.criteria)?!0:!1}),a++,o(u)})}]);